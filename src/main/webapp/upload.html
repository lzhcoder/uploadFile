<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>ajax upfile</title>
		<script type="text/javascript" src="jquery-1.6.min.js"></script>
		<script type="text/javascript" src="ajaxupload.js"></script>
		<script type="text/javascript">
$(document).ready(function(){
    var button = $('#upload_button'), interval;
    var fileType = "all",fileNum = "one"; 
    new AjaxUpload(button,{
        action: 'upload',
        /*data:{
            'buttoninfo':button.text()
        },*/
        name: 'userfile',
        onSubmit : function(file, ext){
            if(fileType == "pic")
            {
                if (ext && /^(jpg|png|jpeg|gif)$/.test(ext)){
                    this.setData({
                        'info': '文件类型为图片'
                    });
                } else {
                    $('<li></li>').appendTo('#example .files').text('非图片类型文件，请重传');
                    return false;               
                }
            }
                        
            button.text('文件上传中');
            
            if(fileNum == 'one')
                this.disable();
            
            interval = window.setInterval(function(){
                var text = button.text();
                if (text.length < 14){
                    button.text(text + '.');                    
                } else {
                    button.text('文件上传中');             
                }
            }, 200);
        },
        onComplete: function(file, response){
        
        	alert("file:"+file);
        	alert("response:"+response);
        	var c=$(response);
        	var ccc=c.text();
        	alert(ccc);
        	
        	czp=eval("'"+ccc+"'");
       
                
            button.text('文件上传');
                        
            window.clearInterval(interval);
                        
            this.enable();
            
            if(response == "success");
                $('<li></li>').appendTo('#example .files').text(file);                  
        }
    });
 
});
</script>
	</head>

	<body>




		<ul>
			<li id="example">
				<div id="upload_button">
					文件上传
				</div>
				<p>
					已上传的文件列表:
				</p>
				<ol class="files"></ol>
		</ul>
	</body>
</html>
